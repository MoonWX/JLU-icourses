# 写在前面

这个项目基本上是一个完全的AIGC项目，所有的代码（甚至这个README）都是由AI生成的，作者仅做了少量的修改和调整。

需要声明的是，这个项目的核心逻辑出自于[H4ckF0rFun](https://github.com/H4ckF0rFun)同学的[F**k-Lesson](https://github.com/H4ckF0rFun/Fuck-Lesson)

# 吉林大学（JLU）全自动抢课脚本

这是一款专为吉林大学学生设计的、功能强大的全自动选课脚本。它旨在帮助你在选课开放的瞬间，以最快的速度、最大的概率抢到心仪的课程。

## 核心特性

  * ✅ **高并发抢课**：为每一门课程建立多个线程池，进行“饱和式”请求，最大化成功率。
  * ✅ **断线自愈**：在遇到网络中断、服务器无响应等任何错误时，程序会自动重新登录并继续任务，无需人工干预。
  * ✅ **会话保活**：能智能检测到“会话过期”或“教学任务过期”等问题，并触发自动重登，实现7x24小时无人值守。
  * ✅ **配置灵活**：支持通过命令行参数进行单次配置，也支持通过 `config.json` 文件进行持久化配置，满足不同使用习惯。
  * ✅ **持续守护**：可选的 `loop` 模式，即使课程已选上，也会持续循环确认，防止因服务器数据回滚导致选课丢失。
  * ✅ **界面清晰**：在终端提供一个动态刷新、排版优美的状态面板，实时展示每门课的抢课状态和请求次数。

-----

## 面向普通用户：快速上手指南

如果您不熟悉编程，请完全按照以下步骤操作，只需几分钟即可运行。

### 第 1 步：下载

1.  找到页面右面的`Release`按钮，点击进入下载页面。
2.  下载最新版本的压缩包（.zip），并解压到您选择的文件夹中。

### 第 2 步：运行

1.  一切准备就绪！双击`icourses.exe`，程序将会启动。
2.  按照说明操作。
3.  开始抢课。您会看到一个动态更新的状态界面。

### 第 3 步：退出

1. 理论上，程序会在选课结束后自动退出（开Loop模式则不会）。
2. 当您想停止抢课时，只需在终端窗口中按下 `Ctrl + C` 组合键，程序会安全地退出。

###  **参数说明**:

      * `"username"`: 你的学号（字符串，需要用双引号包围）。
      * `"password"`: 你的密码（字符串，需要用双引号包围）。
      * `"batch_index"`: **选课批次索引**。这是一个从 **0** 开始的数字。请你先去选课官网上查看选课批次列表，`0` 代表列表中的第一个，`1` 代表第二个，以此类推。请根据您需要抢的课程所属批次正确填写。
      * `"loop"`: 是否开启“持续守护”模式。`true` 代表抢完一轮后会自动开始下一轮（防止数据回滚）；`false` 代表所有课程状态稳定后程序将自动结束。

-----

## 面向高级用户：技术细节与进阶用法

该脚本使用了`ddddOCR`，如果此时`Pillow`的版本>=`10.0.0`，在您执行完`pip install -r requirements.txt`后，可能需要手动修改`ddddOCR`的部分代码，否则执行会报错：`AttributeError: module 'PIL.Image' has no attribute 'ANTIALIAS'`。请将`ddddOCR`目录下的`__init__.py`文件中的`Image.ANTIALIAS`替换为`Image.LANCZOS`。即：

```python
# image = image.resize((int(image.size[0] * (64 / image.size[1])), 64), Image.ANTIALIAS).convert('L')
image = image.resize((int(image.size[0] * (64 / image.size[1])), 64), Image.LANCZOS).convert('L')
```

您可以通过修改脚本开头的常量来调整程序的性能和行为：

  * `WORKER_THREAD_COUNT = 8`: **核心性能参数**。它代表为**每门课**分配的并发线程数。总线程数 = `收藏的课程数 × 8`。
      * **增加此值**：会提高抢课的“攻击性”和成功率，但也会增加本地CPU和网络负载。
      * **降低此值**：会减少资源消耗，如果你的电脑或网络状况不佳，或者收藏的课程非常多，可以适当降低至 `4` 或 `2`。

### 工作原理

本脚本的核心架构基于多线程和状态机，并具备自愈能力。

1.  **主线程 (`main`)**: 负责配置加载、用户交互、启动 `CourseSelector` 以及在必要时重启整个流程。
2.  **ApiClient**: 一个独立的类，封装了所有与吉大教务系统后端的HTTP通信，包括登录、加密、获取列表、提交选课等。
3.  **CourseSelector**: 核心业务逻辑控制器。
      * `run()` 方法负责初始化课程信息，并为每门课创建 `WORKER_THREAD_COUNT` 个 `_worker` 线程。
      * 它通过一个全局的 `relogin_required` 事件来监听所有工作线程的信号。
4.  **工作线程 (`_worker`)**:
      * 每个 `_worker` 都是一个“士兵”，在自己的 `while` 循环里不停地对特定课程发起选课请求。
      * **永不自行终止**：除非接收到全局的 `shutdown_event` (来自`Ctrl+C`或重登信号)。
      * **错误处理**: 当遇到任何无法处理的响应或网络异常时，它不会退出，而是调用 `relogin_required.set()` 向主程序“报警”，然后暂停等待。
5.  **自愈流程**:
    `_worker` 报警 -\> `CourseSelector` 检测到信号 -\> `CourseSelector` 命令所有线程停止并返回“需要重登” -\> `main` 函数捕获到信号 -\> `main` 函数的 `while True` 循环进入下一次迭代 -\> 创建全新的 `ApiClient` 和 `CourseSelector` -\> 完成重登和任务重启。

### 打包
如果您需要将脚本打包成可执行文件，可以使用 `pyinstaller`。以下是打包的基本步骤：

1.  确保已安装 `pyinstaller`：`pip install pyinstaller`
2.  在项目根目录下运行以下命令：（如您看不懂可以参考`.github`目录下的`build_package.yml`文件）
    ```bash
    pyinstaller -F --add-data "{ddddOCR目录}:ddddocr" icourses.py
    ```
3.  打包完成后，生成的可执行文件位于 `dist` 目录下。

-----

## 免责声明

  * 本项目仅供学习和技术交流使用，旨在探讨Python在自动化任务处理方面的应用。
  * 请在遵守吉林大学相关规章制度的前提下使用本脚本。
  * 使用者因使用本脚本而产生的一切后果，包括但不限于被系统识别、账号限制或任何校规校纪处分，均由使用者本人承担。作者不对任何可能产生的后果负责。
  * 请勿将此项目用于任何商业用途或非法活动。

## 许可证

本项目采用 [MIT 许可证](https://opensource.org/licenses/MIT)。